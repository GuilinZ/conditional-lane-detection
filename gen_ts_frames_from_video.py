import cv2
import numpy as np
import json

path = './freeway_drive.MP4'
cap = cv2.VideoCapture(path)
num_frames = int(cap.get(cv2.CAP_PROP_FRAME_COUNT))

js_line = '{"lanes": [[-2, -2, -2, -2, -2, -2, -2, -2, -2, -2, 410, 468, 483, 477, 460, 437, 412, 387, 356, 322, 288, 254, 220, 186, 152, 118, 84, 50, 16, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2], [-2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, 546, 569, 577, 577, 574, 571, 560, 549, 538, 527, 516, 504, 493, 482, 471, 460, 448, 437, 426, 415, 404, 393, 381, 370, 359, 348, 337, 326, 314, 303, 292, 281, 270, 258, 247, 236, 225, 214, 203, 191, 180, 169, 158, 147, 136], [-2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, 588, 641, 684, 705, 722, 740, 757, 769, 780, 792, 803, 815, 827, 838, 850, 861, 873, 885, 896, 908, 919, 931, 943, 954, 966, 977, 989, 1001, 1012, 1024, 1035, 1047, 1059, 1070, 1082, 1093, 1105, 1116, 1128, 1140, 1151, 1163, 1174, 1186, 1198], [-2, -2, -2, -2, -2, -2, -2, -2, -2, -2, 559, 676, 742, 799, 838, 877, 916, 955, 991, 1022, 1053, 1085, 1116, 1147, 1178, 1210, 1241, 1272, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2]], "h_samples": [160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500, 510, 520, 530, 540, 550, 560, 570, 580, 590, 600, 610, 620, 630, 640, 650, 660, 670, 680, 690, 700, 710], '
file_line = '"raw_file": "clips/0530/1492627171538356342_0/20.jpg"}\n'
fp = open('./datasets/video_frames/test_label.json','w')
count = 0
for i in range(num_frames):
    _,frame = cap.read()
    if i % 100 == 0:
        print(i)
    # if i % 2 == 0:
    #     continue
    if i < 600:
        continue
    if i > 1200:
        break

    # if frame is None:
    #     count += 1
    #     print('None here:', i)
    if frame is not None:
        frame = frame[:720, 320:1600, :]
        # cv2.imwrite('./datasets/video_frames/clips/{:0>4d}.jpg'.format(i),frame)
        # fp.write(js_line + '"raw_file": "clips/{:0>4d}.jpg"'.format(i)+'}\n')

        cv2.imwrite('./datasets/video_frames/720_60fps_clips/{:0>4d}.jpg'.format(i),frame)
        fp.write(js_line + '"raw_file": "720_60fps_clips/{:0>4d}.jpg"'.format(i)+'}\n')

print('Done')